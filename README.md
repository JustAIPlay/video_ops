# 即刻视频号运营同步助手 (JiKe Video Ops Sync)

这是一个专为视频号运营团队设计的现代化数据同步仪表盘。它能够连接本地运行的即刻 API 服务，获取视频发布统计数据，并根据灵活的路由策略将其自动同步到飞书多维表格（Feishu Base）中。

界面采用了 **Modern Soft-Neo UI** 设计风格，提供柔和、流畅且专业的交互体验。

## ✨ 主要功能

*   **数据同步核心**：
    *   从本地 API (`http://127.0.0.1:9802`) 拉取视频号统计数据。
    *   **智能去重 (Smart Upsert)**：
        *   **三重精准匹配**：采用「账号名称 + 分钟级发布时间 + 内容描述」联合主键匹配策略。
            *   只有当这三者完全一致时，才判定为旧数据并执行更新（仅刷新统计数据）。
            *   若其中任意一项不匹配（例如人工修改了飞书中的内容描述），系统将视为新视频进行插入，防止错误覆盖。
        *   **字段保护策略**：更新已有记录时，自动保护“内容描述”等人工维护字段不被覆盖；新增记录时则写入全量信息。
        *   支持账号名称特殊字符自动转义，确保查询准确性。
    *   **智能搜索**：支持直接输入**中文账号名称**进行搜索同步，系统会自动处理模糊匹配，无需查找复杂的数字 ID。
    *   **批量查重优化**：同步前自动预读取飞书已有记录，大幅减少 API 调用次数。
*   **灵活的路由策略**：
    *   支持将不同的视频号账号映射到飞书云文档中 **不同的 Base（多维表格）** 和 **数据表 (Table)**。
    *   支持识别 **Wiki Token** 与 **Base Token**，配置更智能。
*   **多模块工作台**：
    *   **数据同步**：核心业务看板。
    *   **发布排期** (开发中)：可视化的内容日历管理。
*   **可视化控制台**：
    *   实时滚动的日志控制台，显示同步进度、新增/更新条数及错误信息。
    *   支持筛选特定的账号或日期范围进行同步。
*   **开发与测试友好**：
    *   内置 **模拟模式 (Mock Mode)**，即使没有本地 API 环境也能演示完整的 UI 交互和逻辑流程。

## 🛠️ 技术栈

*   **前端框架**: React 18+
*   **构建工具**: Vite (推荐) / Create React App
*   **语言**: TypeScript
*   **样式库**: Tailwind CSS
*   **图标库**: Lucide React
*   **UI 风格**: Soft-Neo (柔和渐变、悬浮卡片、大圆角、动态流光按钮)

## 🚀 快速开始

### 1. 环境准备

确保您的本地环境中已安装 Node.js。

### 2. 安装依赖

```bash
npm install
# 或者
yarn install
```

### 3. 启动项目

```bash
npm start
# 或者
npm run dev
```

### 4. 本地 API 服务 (可选)

本项目默认依赖本地运行的即刻数据服务。
*   **接口地址**: `http://127.0.0.1:9802`
*   **基础路径**: `/sph/api`
*   *注意：如果本地服务未启动，您可以点击页面右上角的开关切换至“模拟数据”模式进行体验。*

## ⚙️ 配置指南

在使用同步功能前，请先进入 **「系统配置」** 页面进行设置。

### 1. 凭证设置
输入您的飞书应用凭证（用于未来对接飞书 Open API）：
*   **App ID**
*   **App Secret**

### 2. 路由策略 (Routing Strategy)
这是本系统的核心配置。您需要定义即刻账号数据流向哪个飞书表格。

*   **视频号用户/分组名**: 必须与 API 返回的 `username` 完全一致（例如：`运营大号_A`）。
*   **Base Token**: 飞书多维表格 URL 中的标识符（例如 `appbcb...`）。
*   **Table ID**: 数据表的唯一 ID（例如 `tbl...`）。

**配置示例：**
> 如果配置了账号 `运营大号_A` 指向 Base `app123` 的 Table `tbl999`，那么所有属于 `运营大号_A` 的视频数据在同步时都会自动写入到这张表中。

## 📊 同步字段说明

系统会将以下字段同步至飞书多维表格，请确保您的表格中包含相应列（**列名必须完全一致**，建议字段类型为文本或数字）：

| 飞书字段名 | 说明 | 备注 |
| :--- | :--- | :--- |
| **账号** | 视频号名称 | 必填，作为主键之一 |
| **发布时间** | 视频发布日期 | 必填，作为主键之一 (会自动转换为毫秒时间戳) |
| **浏览次数** | readCount | |
| **推荐次数** | favCount | |
| **评论次数** | commentCount | |
| **分享次数** | forwardCount | |
| **转发聊天和朋友圈** | forwardAggregationCount | |
| **喜欢次数** | likeCount | |
| **完播率** | fullPlayRate | 自动解析百分比 (如 "85%" -> 0.85) |
| **平均播放时长** | avgPlayTimeSec | 自动解析数字 (如 "15.5秒" -> 15.5) |
| **内容描述** | video.name | 对应即刻“动态信息”。**作为去重匹配条件之一**；仅新增时写入，更新时不覆盖 |

## 🎨 设计理念

本项目遵循 **Modern Soft-Neo UI** 设计规范：
*   **色调**: 以柔紫色 (#8C7CF0) 为主色，搭配浅灰白背景 (#FDFBFF)。
*   **布局**: 三栏式悬浮布局，强调内容的层级与呼吸感。
*   **版本**: v1.2.0 (PRO) - 集成多模块导航与智能同步引擎。

## 📝 注意事项

1.  **CORS**: 在浏览器直接请求本地 `127.0.0.1:9802` 时可能会遇到跨域问题，建议为本地 API 配置 CORS 头，或通过代理转发。
2.  **飞书 API**: 目前前端代码中的飞书同步逻辑为模拟实现（打印日志）。在生产环境中，建议通过后端中间件调用飞书 Open API，以保护 App Secret 安全。

---
© 2024 Video Ops Assistant. Designed for efficiency.
