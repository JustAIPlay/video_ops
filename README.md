# 大航海运营助手 (Video Ops Assistant)

这是一个专为视频号运营团队设计的现代化数据同步与排期规划仪表盘。它能够连接本地运行的大航海 API 服务，获取视频发布统计数据，自动同步到飞书多维表格（Feishu Base），并提供智能化的视频排期建议功能。

界面采用了 **Modern Soft-Neo UI** 设计风格，提供柔和、流畅且专业的交互体验。

## ✨ 主要功能

*   **数据同步核心 (Data Sync)**：
    *   从本地 API (`http://127.0.0.1:9802`) 拉取视频号统计数据。
    *   **智能去重 (Smart Upsert)**：
        *   **三重精准匹配**：采用「账号名称 + 分钟级发布时间 + 内容描述」联合主键匹配策略。
        *   只有当这三者完全一致时，才判定为旧数据并执行更新（仅刷新统计数据）。
        *   若其中任意一项不匹配（例如人工修改了飞书中的内容描述），系统将视为新视频进行插入，防止错误覆盖。
    *   **字段保护策略**：更新已有记录时，自动保护“内容描述”等人工维护字段不被覆盖；新增记录时则写入全量信息。
    *   **智能搜索**：支持直接输入**中文账号名称**进行搜索同步，系统会自动处理模糊匹配。
    *   **批量查重优化**：同步前自动预读取飞书已有记录，大幅减少 API 调用次数。

*   **发布排期规划 (Schedule Planning)**：
        *   **智能筛选逻辑 (按分组策略)**：
            *   **1. 全局基础门槛 (Universal Rules)**：
                *   所有进入排期池的视频，必须同时满足以下两个硬性条件，否则直接被过滤掉：
                *   **浏览量门槛**：`浏览次数 (readCount) >= 1000`（只保留有一定热度的数据）。
                *   **疲劳度控制**：`重复次数 (repeatCount) < 3`（该视频编号在当前分组的历史数据中出现的次数必须少于 3 次）。
            *   **2. 分组白名单 (Allowed Groups)**：
                *   系统目前仅处理包含以下关键字的分组：`ai绿植`、`图书`、`汽车`、`家清`、`百货`。
            *   **3. 分组差异化策略 (Differentiation Strategy)**：
                *   **后端逻辑**: 仅负责上述“基础门槛”的筛选，**不再进行任何强制去重**。所有符合条件的数据都会返回给前端。
                *   **前端交互**: 提供“展示模式”开关，用户可自由切换：
                    *   **全部展示 (All Mode)**: 展示所有后端返回的数据，即使同一视频编号出现多次（适用于查看历史详情）。
                    *   **去重展示 (Unique Mode)**: 系统在前端进行实时去重，按 `(分组名 + 视频编号)` 为唯一键，只保留**浏览量最高**的那一条（适用于制作排期表）。
            *   **4. 排序规则 (Sorting)**：
                *   最终输出的列表，统一按照 **浏览量 (readCount) 从高到低** 排序。
            *   **实时计算**：动态计算每个视频所属账号在**今日**的已发布数量。
    *   **可视化排期表**：
        *   **列表展示**：按浏览量倒序展示建议排期的视频列表，支持按分组筛选查看。
        *   **关键指标**：
            *   **账号**：展示视频所属的账号名称。
            *   **历史发布次数**：展示该视频在组内的累计发布次数。
            *   **账号今日发布次数**：展示该账号今日已发视频数。**若今日已有发布（>0），该数字将高亮显示（橙色），提示运营注意频控。**
    *   **数据统计**：实时显示筛选通过率及被拒绝的原因（浏览量不足或重复过多）。

*   **灵活的路由策略**：
    *   支持将不同的视频号账号映射到飞书云文档中 **不同的 Base（多维表格）** 和 **数据表 (Table)**。
    *   支持识别 **Wiki Token** 与 **Base Token**，配置更智能。

*   **可视化控制台**：
    *   实时滚动的日志控制台，显示同步进度、新增/更新条数、筛选统计及错误信息。
    *   **UI 风格统一**：所有模块（同步、配置、排期）均采用一致的大圆角卡片与渐变流光设计。

## 🛠️ 技术栈

*   **前端框架**: React 18+
*   **构建工具**: Vite
*   **语言**: TypeScript
*   **样式库**: Tailwind CSS
*   **图标库**: Lucide React
*   **网络请求**: Fetch API (配合 Vite Proxy 解决跨域与鉴权问题)
*   **UI 风格**: Soft-Neo (柔和渐变、悬浮卡片、大圆角、动态流光按钮)

## 🚀 快速开始

### 1. 环境准备

确保您的本地环境中已安装 Node.js。

### 2. 安装依赖

```bash
npm install
# 或者
yarn install
```

### 3. 启动项目

```bash
npm run dev
```
*   项目默认运行在 `http://localhost:5173`
*   **注意**：项目配置了 `/feishu-api` 代理，用于转发请求到飞书开放平台，请确保开发环境网络正常。

### 4. 本地 API 服务 (依赖项)

本项目依赖本地运行的大航海数据服务来获取视频数据。
*   **接口地址**: `http://127.0.0.1:9802`
*   **基础路径**: `/sph/api`

## ⚙️ 配置指南

在使用功能前，请先进入 **「系统配置」** 页面进行设置。

### 1. 凭证设置
输入您的飞书应用凭证（用于调用飞书 Open API）：
*   **App ID**
*   **App Secret**

### 2. 路由策略 (Routing Strategy)
定义大航海账号数据流向哪个飞书表格。
*   **视频号用户/分组名**: 必须与 API 返回的 `username` 完全一致（例如：`运营大号_A`）或与排期分组名一致（例如：`ai绿植`、`图书`、`汽车`、`家清`、`百货`）。
*   **Base Token**: 飞书多维表格 URL 中的标识符（支持 Wiki URL Token 自动解析）。
*   **Table ID**: 数据表的唯一 ID。

## 📊 同步字段说明

系统会将以下字段同步至飞书多维表格，请确保您的表格中包含相应列（**列名必须完全一致**）：

| 飞书字段名 | 说明 | 备注 |
| :--- | :--- | :--- |
| **账号** | 视频号名称 | 必填，主键之一 |
| **发布时间** | 视频发布日期 | 必填，主键之一 (时间戳) |
| **浏览次数** | readCount | |
| **推荐次数** | favCount | |
| **评论次数** | commentCount | |
| **分享次数** | forwardCount | |
| **转发聊天和朋友圈** | forwardAggregationCount | |
| **喜欢次数** | likeCount | |
| **完播率** | fullPlayRate | 自动解析百分比 |
| **平均播放时长** | avgPlayTimeSec | 自动解析数字 |
| **内容描述** | video.name | 对应大航海“动态信息”，主键之一 |
| **视频编号** | (排期用) | 需在飞书中配置捷径生成 |

## 🎨 设计理念

本项目遵循 **Modern Soft-Neo UI** 设计规范：
*   **色调**: 以柔紫色 (#8C7CF0) 为主色，搭配浅灰白背景 (#FDFBFF) 与渐变装饰。
*   **布局**: 响应式三栏/两栏布局，强调内容的层级与呼吸感。
*   **版本**: v1.2.0 (PRO)

---
© 2024 Video Ops Assistant. Designed for efficiency.